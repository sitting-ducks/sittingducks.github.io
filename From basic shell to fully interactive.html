<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Marco Meli">
  <meta name="description" content="From basic shell to fully interactive | Quite often during a pentest you finally manage to get a shell (potentially after several attempts and lot of...">

  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" type="text/css" media="all">
  <link rel="stylesheet" href="https://sittingducks.io/theme/css/font.css" type="text/css" media="all">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://sittingducks.io/theme/css/style.css" type="text/css" media="all">

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://sittingducks.io/theme/js/functions.min.js"></script>

  
 


<meta name="keywords" content="CheatSheets">


  <title>From basic shell to fully interactive</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-156989597-1', 'auto');
  ga('send', 'pageview');

</script>
  
</head>

<body class="home blog">
  <div>
    <header class="site-header">
      <nav class="navbar navbar-default" role="navigation">
        <div class="container">
          <div class="row">
            <div class="site-navigation-inner col-sm-12">
              <div class="navbar-header">
                <button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
              </div>
              <div class="collapse navbar-collapse navbar-ex1-collapse">
              <ul id="menu-all-pages" class="nav navbar-nav">
                <li class="menu-item"><a href="https://sittingducks.io" >home
<i class="fa  fa-lg"></i></a></li>
              </ul>
              </div>
              <div class="social">   
                <a href="https://linkedin.com/in/marco-meli-12668530/" title="Linkedin" >
<i class="fa fa-linkedin fa-lg"></i></a>
              </div>
            </div>
          </div>
        </div>
      </nav><!-- .site-navigation -->

      <div class="container">
      <div id="logo">
        <span class="site-name"><a class="navbar-brand" href="https://sittingducks.io"><img width="310" src="images/logo.png" class="attachment-full size-full" alt="logo">          </a>
        </span><!-- end of .site-name -->
      </div><!-- end of #logo -->
        <div class="tagline">
                <a href="https://sittingducks.io/tag/cheatsheets.html" >CheatSheets (1)</a> &#124; 
                <a href="https://sittingducks.io/tag/hackthebox.html" >HackTheBox (13)</a> &#124; 
                <a href="https://sittingducks.io/tag/vulnhub.html" >VulnHub (1)</a> &#124; 
                <a href="https://sittingducks.io/archives.html" >Archives (15)</a>
        </div>
    </div>

  </header><!-- #masthead -->
  </div>
    <div id="content" class="site-content">
      <div class="container main-content-area">
        <div class="row">
          <div class="main-content-inner col-sm-12 col-md-12">
            <div id="primary" class="content-area">
              <div id="main" class="site-main" role="main">
                <div class="article-container">
<article>
  <div class="blog-item-wrap">
    <div class="post-inner-content">
      <header class="entry-header page-header">
        <span class="cat-item"><time datetime="2020-02-11 20:58:00+00:00">Tue 11 February 2020</time></span>
        <h1 class="entry-title"><a href="https://sittingducks.io/From basic shell to fully interactive.html">From basic shell to fully interactive</a></h1>
      </header><!-- .entry-header -->
      <div class="fb-like" data-href="https://sittingducks.io/From basic shell to fully interactive.html" data-layout="standard" data-action="like" data-show-faces="false" data-share="true"></div>
      <div class="entry-content">
        <p>Quite often during a pentest you finally manage to get a shell (potentially after several attempts and lot of time spent) but you soon find out the shell is very limited, in that tab-autocomplete, history, selection, etc. do not work and it is very frustrating to continue your engagement that way. This article describes how to upgrade from a limited shell to a fully interactive shell with a practicle example.</p>
<p>Let us assume I managed to get a shell and I ran the <strong><em>whoami</em></strong> command showing I am in as the <code>tomcat</code> user:</p>
<div class="highlight"><pre><span></span>root@Kali:~# nc -lvnp <span class="m">1234</span>
listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">1234</span> ...
connect to <span class="o">[</span><span class="m">192</span>.168.12.33<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span><span class="m">192</span>.168.12.123<span class="o">]</span> <span class="m">34780</span>
whoami
tomcat
python -c <span class="s1">&#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
tomcat@server1:/$ 
</pre></div>


<p>As my next step I ran the above python command <code>python -c 'import pty;pty.spawn("/bin/bash")'</code> to upgrade to an interactive bash pty shell. We still do not have tab-autocomplete, history, etc. so we can do the following to get a complete working shell (from the pty shell):</p>
<p>hit <code>CTRL+Z</code> to put the shell in the background:</p>
<div class="highlight"><pre><span></span><span class="err">tomcat@server1:/$ ^Z</span>
<span class="err"> [1]+  Stopped                 nc -lvnp 1234</span>
</pre></div>


<p>run <code>echo $TERM</code> and <code>stty -a</code> to know the terminal type (screen-256color) and the size (rows 54; columns 190;) of the current TTY respectively, as shown below:</p>
<div class="highlight"><pre><span></span><span class="err">root@Kali:~# echo $TERM</span>
<span class="err">screen-256color</span>
</pre></div>


<p>and</p>
<div class="highlight"><pre><span></span><span class="err">root@Kali:~# stty -a</span>
<span class="err">speed 38400 baud; rows 54; columns 190; line = 0;</span>
<span class="err">intr = ^C; quit = ^\; erase = ^?; kill = ^U; eof = ^D; eol = &lt;undef&gt;; eol2 = &lt;undef&gt;; swtch = &lt;undef&gt;; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O;min = 1; time = 0;-parenb -parodd -cmspar cs8 -hupcl -cstopb cread -clocal -crtscts-ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel -iutf8opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke -flusho -extproc</span>
</pre></div>


<p>With the shell still in the background, now set the current STTY to type raw and tell it to echo the input characters with the following         command:</p>
<div class="highlight"><pre><span></span><span class="err">root@Kali:~# stty raw -echo</span>
</pre></div>


<p>Now foreground the shell with the <strong>fg</strong> command:</p>
<div class="highlight"><pre><span></span><span class="err">root@Kali:~# nc -lvnp 1234</span>
<span class="err">                          reset</span>
<span class="c">reset: unknown terminal type unknown</span>
<span class="err">Terminal type? screen-256color</span>
</pre></div>


<p>You will have the netcat listener back. Digit <code>reset</code> to reinitialize the terminal and when you are asked for the terminal type add the output of the <code>echo $TERM</code> command I ran before.</p>
<p>After the reset the shell should look normal again. The last step is to set the stty size to match our current Kali window (from the info gathered on point 2)</p>
<div class="highlight"><pre><span></span><span class="err">tomcat@server1:/$ stty rows 54 columns 190</span>
</pre></div>


<p>Now we have a full interactive shell.</p>
      </div><!-- .entry-content -->
      <br /><br />
      <div class="article_meta">
        Tags:
          <a href="https://sittingducks.io/tag/cheatsheets.html">CheatSheets</a>      </div>
    </div>
  </div>
</article><!-- #post-## -->
                </div>
              </div><!-- #main -->
          </div><!-- #primary -->
        </div>
      </div><!-- close .row -->
    </div><!-- close .container -->
  </div><!-- close .site-content -->




  <div id="footer-area">
    <footer id="colophon" class="site-footer" role="contentinfo">
      <div class="site-info container">
        <div class="row">
                    <div class="copyright col-md-12">
                    <a href="https://sittingducks.io/pages/privacy-policy">Privacy Policy</a> | 
                    <a href="https://sittingducks.io/feeds/all.atom.xml">Atom Feed</a> | 
                    <a href="https://sittingducks.io/sitemap.xml">Sitemap</a><br />                    &copy; 2019 <a href="https://sittingducks.io">Marco Meli</a> </div>
        </div>
      </div><!-- .site-info -->
      <div class="scroll-to-top" style="display: none;"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
    </footer><!-- #colophon -->
  </div>

  <script type="text/javascript">
    window.addEventListener('load', function(){
    if (window.location.pathname != '/' && window.location.pathname != '/index.html'){
      window.scroll(0, document.getElementById('main').offsetTop);
    }})
  </script>




</body>
</html>